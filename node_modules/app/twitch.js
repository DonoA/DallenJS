var fs = require('fs');
var mysql = require('mysql');
var irc = require("irc");

fs.readFile('config.json', 'utf8', function (err, data) {
  if(err){
    console.log(err);
  }
  var bot = new irc.Client("irc.twitch.tv", "dallen1393", {
      channels: streams,
      port: 6667,
      password: JSON.parse(data).secrets.twitchKey

  });
  console.log("twitch bot connected");
  bot.addListener("message", function(from, to, text, message) {
      var q = "Insert into "+to.replace("#","")+" (User, Chat) Values ('"+from.replace(new RegExp("'", 'g'), '')+
              "', '"+text.replace(new RegExp("'", 'g'), '')+"')";
      dbconnection.query(q, function(err, rows) {
          if(err){
            //  console.log(q);
            //  console.error('twitch sql error: ' + err.message);
          }
      });
  });
});
