var mysql = require('mysql');
var debug = require('debug')('DallenJS:server');
var fs = require('fs');

var dbconnection = mysql.createConnection(GLOBAL.ConnStr);

var user = {
  listUsers: function(callback){
      var q = "select username, email, user_type from users";
      dbconnection.query(q, function(err, rows) {
          if(err){
            console.error(err.stack);
          }else{
            callback(rows);
          }
      });
  },
  getUser: function(id, callback){
      var q = "select * from users where GoogleID='"+id+"'";
      dbconnection.query(q, function(err, rows) {
          if(err){
            console.error(err.stack);
          }else{
            callback(rows);
          }
      });
  },
  addUser: function(profile, username, callback){
    var q = "insert into users (Username, Email, GoogleID) values ('"+username+"', '"+profile.emails[0].value+"', "+profile.id+")";
    console.log(q);
    dbconnection.query(q, function(err, rows) {
        if(err){
          console.error(err.stack);
        }else{
          callback(rows);
        }
    });
  },
  setUserType: function(username, user_type, callback){
    var q = "update";
    dbconnection.query(q, function(err, rows) {
        if(err){
          console.error(err.stack);
        }else{
          callback(rows);
        }
    });
  },
  connect: function(){
    dbconnection.connect(function(err) {
      if (err) {
        console.error('error connecting: ' + err.stack);
        return;
      }
      console.log('connected as id ' + dbconnection.threadId);
    });
  }
};

module.exports = user;
